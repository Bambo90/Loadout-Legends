#!/bin/sh
# post-commit hook: append an automated worklog entry without committing
# This hook runs after successful commits. It appends a timestamped entry
# and avoids committing to prevent recursive hooks.

LAST_MSG=$(git log -1 --pretty=%B)
# Skip if the last commit was a worklog commit
echo "$LAST_MSG" | grep -q "Worklog:" && exit 0

SHORT=$(git rev-parse --short HEAD)
MSG="Auto: commit ${SHORT}"
ROOT=$(git rev-parse --show-toplevel)
WORKLOG_SCRIPT="$ROOT/update_worklog.js"
if [ -f "$WORKLOG_SCRIPT" ]; then
	node "$WORKLOG_SCRIPT" "$MSG" --no-commit || true
else
	echo "post-commit: update_worklog.js not found, skipping."
fi
