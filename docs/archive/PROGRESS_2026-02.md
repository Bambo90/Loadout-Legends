Original prompt: Du warst grade dabei irgendwas für das zukünftige Wrapping minimal invasiv umzubauen und plötzlicher ist der ganze Chat weg gewesen. Ich glaube es ist nicht kaputt Abgesehen davon, wenn ich nun im Abenteuer-Zentrum über die Kacheln Hover wie Chroniken, Arena etc. wird das, was dann ausfährt plötzlich unten abgeschnitten und in einem kleinen Scrollbaren Container angezeigt, was so nicht soll

- 2026-02-13: Investigated clipping/scroll issue in Adventure hub dropdowns.
- 2026-02-13: Applied minimal CSS fix in `style.css`:
  - `#tab-grind:not(.world-view)` now handles vertical scrolling (no nested mini-scroll container).
  - `#tab-grind:not(.world-view) .adventure-hub` no longer constrains `max-height` and no longer uses internal overflow.
- 2026-02-13: Tried running the skill Playwright client, but it currently fails to resolve `playwright` when executing from `C:/Users/bbs2e/.codex/skills/develop-web-game/scripts/web_game_playwright_client.js` (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Zone submenu (Kuestenpfad) CTA fix: `Kampf starten` no longer slides sideways on hover; kept highlight behavior by overriding hover transform for `.zone-start-btn`.
- 2026-02-13: Kuestenpfad monster stats overlay now unfolds from the right edge of the monster container with a 5px gap (`.zone-stats-panel` anchored via `left: calc(100% + 5px)` and slide-in transform on hover).
- 2026-02-13: Verification attempt repeated; skill Playwright client still blocked by missing module resolution (`ERR_MODULE_NOT_FOUND: playwright`) from the skill script path.
- 2026-02-13: World submenu layout adjusted upward: reduced top spacing for world header and world adventure hub so Akt cards/text blocks start higher on screen.
- 2026-02-13: Post-change verification attempt blocked again: skill Playwright client still fails with `ERR_MODULE_NOT_FOUND: playwright`.
- 2026-02-13: Added `Akt 3 - Coming Soon` as locked act card in `worldData.js` for world submenu visibility.
- 2026-02-13: Post-change verification attempt for the act update also blocked by the same Playwright resolver issue (`ERR_MODULE_NOT_FOUND: playwright`).
- 2026-02-13: Documentation audit executed for all `.md`/`.txt` files. Updated `README.md`, `GAME_DESIGN.md`, `DRAG_DROP_ARCHITECTURE.md`, and `ITEM_SYSTEM_GUIDE.md` to reflect current architecture/state.
- 2026-02-13: Post-doc-update verification attempt still blocked: skill Playwright client cannot resolve `playwright` module (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Implemented save versioning and migration in `saveengine.js`:
  - Added wrapper save format `{ saveVersion, data }`.
  - Added sequential `migrateSave(data, version)` with v0->v1 migration (`gold` moved to `currencies.gold`).
  - Added backward compatibility for legacy unversioned saves (treated as version 0).
  - Added runtime bridge to keep `gameData.gold` in sync from migrated `currencies.gold` while existing systems still consume `gold`.
- 2026-02-13: Post-save-migration verification attempt with skill client still blocked by missing module resolution (`ERR_MODULE_NOT_FOUND: playwright`).
- 2026-02-13: Refactor item-definition pipeline:
  - Added `itemDefs.js` as centralized static definition access layer (`getItemDefById`) and save sanitization utilities.
  - Updated `index.html` script order to load `itemDefs.js` after `itemRegistry.js`.
  - Updated runtime lookups (`script.js`, `workshopEngine.js`, `saveengine.js`) to resolve gameplay values via item definitions by `itemId`.
  - Updated save persistence to sanitize grid cells and strip static item fields from saves.
  - Added legacy migration in `migrateSave` for embedded item payloads (`item/baseId` -> `itemId`).
- 2026-02-13: Node smoke tests passed for save wrapper, migration, and static-field stripping from saved grid cells.
- 2026-02-13: Post-itemDefs verification attempt with skill client still blocked by missing module resolution (`ERR_MODULE_NOT_FOUND: playwright`).
- 2026-02-13: Re-validated syntax after refactor (`node --check` for `itemDefs.js`, `saveengine.js`, `script.js`, `workshopEngine.js`, `storageEngine.js`) with no syntax errors.
- 2026-02-13: Executed additional VM smoke test for backward compatibility:
  - Legacy unwrapped save payload loaded successfully.
  - v0 migration restored `itemId` from embedded `item.id`.
  - Static fields (e.g. `damage`) were stripped from persisted grid-cell save data.
  - Currency migration (`gold` -> `currencies.gold`) and runtime gold bridge verified.
- 2026-02-13: Skill client re-check still blocked: `web_game_playwright_client.js` fails immediately due missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Hardening tweak in `saveengine.js`:
  - `normalizeGridInstances` now allows either `getItemDefById` or `getItemById` as valid lookup source (prevents unnecessary early return in future registry refactors).
- 2026-02-13: Re-ran syntax and migration smoke test after hardening tweak; checks still pass (`SMOKE_OK`).
- 2026-02-13: Fixed missing world/zone scene backgrounds:
  - Added CSS fallback backgrounds for `#tab-grind.world-view` and `#tab-grind.world-view.zone-view`.
  - Normalized runtime scene image URLs in `script.js` to `./Media/...` paths.
- 2026-02-13: Added global resolution compensation scaling in `style.css`:
  - New root variables `--resolution-ui-scale-fhd` (default `1.14`) and `--resolution-ui-scale`.
  - On `@media (max-width: 1920px)`, app uses the FHD scale factor.
  - `#app-container` now applies `transform: scale(...)` with inverse width/height compensation so 2560x1440 remains unchanged while Full HD can match visual size.
- 2026-02-13: Fixed workshop fullscreen regression under global scaling:
  - `#workshop-overlay` changed from `position: fixed; width: 100vw; height: 100vh;` to container-relative fullscreen (`position: absolute; inset: 0; width: 100%; height: 100%;`).
  - Prevents right/bottom background leakage when `#app-container` uses `transform: scale(...)`.
- 2026-02-13: Playwright skill check attempted again; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Added two new coast monsters in `monsters.js` with initial placeholder balance:
  - `captain_1` / "Ertrunkener Kapitän" using `Media/Images/Monster/Drunken_Captain.png`.
  - `thief_1` / "Wegelagerer" using `Media/Images/Monster/Thief_B.png`.
  - Both tagged with `["coast"]` and empty `dropTable` for later balancing.
- 2026-02-13: Syntax check passed for `monsters.js` (`node --check`).
- 2026-02-13: Playwright skill run attempted after monster update; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Added PVE workshop background integration:
  - `openWorkshop(type)` now applies overlay mode classes (`workshop-farm`, `workshop-pve`, `workshop-storage`).
  - `closeWorkshop()` clears those classes.
  - New CSS rule `#workshop-overlay.workshop-pve` uses `Media/Images/World/PVE_Workshop.png` with dark overlay gradient for readability.
- 2026-02-13: Syntax check passed for `script.js` after workshop class changes.
- 2026-02-13: Playwright skill check attempted again; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Removed extra dark layer from PVE workshop background (`#workshop-overlay.workshop-pve`) and disabled blur for that mode.
- 2026-02-13: Added farm workshop background rule:
  - `#workshop-overlay.workshop-farm` now uses `Media/Images/World/Farm_Workshop.png` (cover/center/no-repeat) with `backdrop-filter: none`.
- 2026-02-13: Playwright skill check attempted after farm background update; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Changed workshop background sizing from `cover` to `contain` for both farm and pve modes so full image is visible without crop.
- 2026-02-13: Playwright skill check attempted after `contain` change; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Switched workshop backgrounds back to `cover` with explicit focus point:
  - `#workshop-overlay.workshop-farm` now uses `background-position: 50% 42%`.
  - `#workshop-overlay.workshop-pve` now uses `background-position: 50% 42%`.
  - Keeps full-frame fill while allowing controlled crop via focus tuning.
- 2026-02-13: Playwright skill check attempted after cover/focus update; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Updated farm workshop background source to `Media/Images/World/Farm_WorkshopA.png` for user comparison.
- 2026-02-13: Checked `Farm_WorkshopA.png` dimensions from disk: `1536x1024` (not `1331x679`).
- 2026-02-13: Playwright skill check attempted after farm background source swap; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Switched farm workshop background source to `Media/Images/World/Farm_Workshop_B.png` (user requested A/B comparison).
- 2026-02-13: Checked `Farm_Workshop_B.png` dimensions from disk: `1536x1024`.
- 2026-02-13: Playwright skill check attempted after B-source swap; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Switched farm workshop background source to `Media/Images/World/Farm_Workshop_C.png` (user requested further comparison).
- 2026-02-13: Checked `Farm_Workshop_C.png` dimensions from disk: `1536x1024`.
- 2026-02-13: Playwright skill check attempted after C-source swap; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- 2026-02-13: Implemented scalable character/stat architecture with a new central module `character.js`:
  - Added persistent `character.base` model (level/xp/base attributes/base resources/base damage/weight data).
  - Added derived stat pipeline `computeCharacterStats()` with strict order:
    1) base load
    2) attribute + level scaling
    3) item flat modifiers
    4) item percent modifiers
    5) weight effects
    6) finalize derived stats
- Added extendable legacy damage-type mapping for both damage and armor maps.
  - Added generic modifier format `{ statPath, type, value }` and legacy-item-to-modifier conversion layer.
  - Added hard-cap item deactivation by weight and soft stamina-cost penalty from carried weight.
  - Added exponential XP function `calculateXpToNextLevel(baseXP * growthFactor^level)`.
  - Added runtime cache/dirty model so derived computation runs on invalidation events, not every render pass.
- 2026-02-13: Integrated character architecture into existing systems:
  - `index.html`: inserted `character.js` before `saveengine.js` / combat systems.
  - `saveengine.js`:
    - bumped `SAVE_VERSION` to `2`,
    - added migration `v1 -> v2` for legacy top-level character fields into `character.base`,
    - save pipeline now persists base character only (`sanitizeCharacterForSave` removes derived + legacy mirrors),
    - load path now ensures character model, invalidates, and recomputes derived stats.
  - `combatEngine.js` refactored to consume derived character stats (fallback-safe legacy wrappers preserved).
  - `script.js` refactored gameplay flow to use derived character stats for speed/xp bonuses/damage and centralized XP progression via `grantCharacterXP`.
  - `pvp.js` now reads character level/life from model and awards XP via character API.
- 2026-02-13: Backward-compatibility validation:
  - Node checks passed: `character.js`, `saveengine.js`, `combatEngine.js`, `script.js`, `pvp.js`.
  - Character module smoke test passed (`CHARACTER_SMOKE_OK`).
  - Save migration smoke test passed (`SAVE_V2_SMOKE_OK`): v1 wrapped save migrates to v2 with `character.base`; derived stats are not persisted; legacy top-level stat fields removed from saved payload.
- 2026-02-13: Playwright skill check attempted after architecture refactor; still blocked by missing `playwright` package (`ERR_MODULE_NOT_FOUND`).
- TODO: Run visual regression check in browser/Playwright to confirm dropdowns are fully visible on hover for Chroniken/Arena/Ressourcen and no side effects in world/zone view.
- 2026-02-13: Added scalable PoE-style item architecture (no UI changes):
  - New `affixDefs.js` with centralized affix schema (`implicit|prefix|suffix`, statPath, type, tier ranges + requiredIlvl).
  - New `generator.js` with `generateItem(baseItemId, itemLevel)` for tier eligibility, tier selection, value rolls, implicit optionality, and prefix/suffix slot limits.
  - Reworked `itemDefs.js` to normalize base item schema (`baseType`, `weight`, `baseStats`, `implicitPool`, `prefixSlots`, `suffixSlots`) while preserving legacy fields.
  - Added runtime instance model store (`gameData.itemInstances`) and helpers for register/get/sanitize instance records.
  - Added runtime modifier composition: BaseStats + implicit/prefix/suffix rolls, with fallback to legacy `item.modifiers`.
  - Save compatibility retained: grid cells still store only dynamic placement data; `itemInstances` sanitized/pruned by active instance IDs in save sanitizer.
  - Integrated runtime resolver in stat path: `character.collectEquippedItemEntries` now passes full cell context to resolver.
  - Integrated generation hooks in `script.js`: shop buys and monster drops register item instances by `instanceId`.
  - Updated `index.html` script order to include `affixDefs.js` and `generator.js`.
- 2026-02-13: Validation:
  - `node --check` passed for `affixDefs.js`, `generator.js`, `itemDefs.js`, `character.js`, `script.js`.
  - Smoke test passed for base schema normalization, item generation, runtime modifier composition, and save sanitization of `itemInstances`.
- 2026-02-13: Playwright skill client re-check still blocked by missing dependency (ERR_MODULE_NOT_FOUND: playwright).
- 2026-02-14: Fixed world menu scroll/layout jitter in style.css by scoping world-menu-only overrides: removed internal dventure-hub scrolling in #tab-grind.world-view:not(.zone-view) and disabled card hover translate there to keep 'Akt 1/2/3' labels static.
- 2026-02-14: Added modular character panel system (UI-only):
  - New files: `characterPanel.js`, `characterPanel.css`.
  - Added compact + expandable breakdown panel (Damage/Defense/Attributes/Weight), generic object-key rendering.
  - Added new nav tab `Charakter` with centered overview panel (`#tab-character`).
  - Integrated workshop layout wrapper (`.workshop-grid-panel-layout`) with panel host beside active setup grid.
  - Added recompute UI hook in `character.js`: emits `character:stats-updated` after `recomputeCharacterDerivedStats`.
  - Script hooks in `script.js`:
    - `buildCharacterPanelPayload(...)` reads compute outputs and base snapshot without moving combat logic.
    - `mountCharacterPanels()` mounts workshop compact panel + full overview panel.
    - `refreshCharacterPanels()` called on workshop open/close, character-tab activation, initial load.
  - No render-loop panel updates; updates are event-driven via recompute event and explicit UI hooks.
- 2026-02-14: Playwright skill client run blocked again (`ERR_MODULE_NOT_FOUND: playwright`).
- 2026-02-17: Added UI SFX wiring for button/menu/shop/storage actions:
  - `script.js`: added central `playUISound(...)` loader/cache for `Back_A`, `Click_A`, `Item_Bought_A`, `Item_Sold_A`, `Mouse_Over_Menu_A`.
  - `script.js`: added delegated button listeners via `initUISoundBindings()`:
    - Back/Zurueck buttons -> `Back_A`.
    - Non-back menu button clicks -> `Click_A`.
    - Button hover/highlight mouseover -> `Mouse_Over_Menu_A` (throttled, button-only).
    - Buy and sell-commit buttons excluded from generic click SFX to avoid duplicate playback.
  - `script.js`: `buyItem(...)` now plays `Item_Bought_A` only after a successful purchase.
  - `storageEngine.js`: `executeBulkSell(...)` now plays `Item_Sold_A` only after at least one item was sold.
- 2026-02-17: Verification constraints:
  - `node --check` could not run in this environment because `node` is not available in PATH.
  - Playwright skill client was not runnable in this environment for the same reason.
  - Explicit client start attempt (`web_game_playwright_client.js --help`) failed immediately: `node` command not found.
- 2026-02-17: Follow-up fix for Storage sell interaction:
  - `script.js`: UI sound playback made fail-safe (`try/catch`) so audio cannot interrupt click handlers.
  - `script.js`: button click/hover SFX now deferred via `setTimeout(..., 0)` to decouple sound from action flow.
  - `script.js`: delegated button listeners switched to default bubbling phase (no capture), preventing pre-target interference.
  - `script.js`: `_normalizeButtonLabel` hardened to handle environments without `String.prototype.normalize`.
- 2026-02-17: Storage SELL toggle reliability fix:
  - `script.js`: mirror `currentWorkshop` to `window.currentWorkshop` on init/open/close.
  - `storageEngine.js`: added `_getCurrentWorkshopType()` helper with safe fallback to `window.currentWorkshop`.
  - `storageEngine.js`: switched SELL guard and storage UI enable/visibility checks to `_getCurrentWorkshopType()` so SELL mode can always toggle in storage overlay.
- 2026-02-17: Storage SELL behavior polish + mode guard hardening:
  - `storageEngine.js`: SELL button now always keeps label `SELL` (no `VIEW (...)` text swap).
  - `storageEngine.js`: added `_isStorageModeActive()` using actual overlay classes (`.storage-mode` / `.workshop-storage`) as source of truth.
  - `storageEngine.js`: `toggleBulkSellMode()` now keys off `_isStorageModeActive()` so button toggles reliably when overlay is in storage mode.
  - `storageEngine.js`: storage actions visibility and button disabled state now follow `_isStorageModeActive()`.
  - `storageEngine.js`: render refresh now also runs when storage overlay is active, even if `currentWorkshop` is temporarily unavailable.
- 2026-02-17: SELL click binding hardening:
  - `storageEngine.js`: added one-time direct event binding for `#bulk-sell-btn` in `_bindStoragePageControls()`.
  - `storageEngine.js`: inline `onclick` is removed at runtime and replaced with explicit `addEventListener('click', ...)` to prevent silent no-op or double-trigger conflicts.
- 2026-02-17: SELL mode expanded to equipment workshop bank + gold-total counter:
  - `workshopEngine.js`: removed `currentWorkshop === 'storage'` restriction for bank item selection while SELL mode is active.
  - `workshopEngine.js`: drag-start block in SELL mode now applies to bank items in all workshop types, not storage-only.
  - `storageEngine.js`: `_isStorageModeActive()` now treats visible workshop overlay + bank grid as valid SELL context (supports left bank in Ausruestung tab).
  - `storageEngine.js`: added `_getSelectedSellTotalGold()` and changed execute button label to `Sell <gold> Gold` (sum of selected item values, not item count).
- 2026-02-17: HUD bars now use canonical character stats:
  - `script.js`: added `_getHudStats()` to read `currentLife`, `maxLife`, `xp`, `xpToNextLevel` from the character model.
  - `script.js`: HP/XP fills now use `_getHudStats()` ratios, and UI refreshes on `character:stats-updated`.
- 2026-02-17: Removed legacy idle gold/xp/bonus prototype loop:
  - `script.js`: `updateLogic()` no longer applies passive work tick, passive gold/xp rewards, or auto monster damage from work progress.
  - `script.js`: idle-only runtime fields are neutralized each update (`workProgress = 0`, `pendingGold = 0`).
  - `script.js`: added canonical reward hooks `addGold(amount, reason)` and `grantXP(amount, reason, gridKey)` and exposed them on `window`.
  - `script.js`: shop purchase now uses `addGold(-price, 'shop_buy')`.
  - `script.js`: top HUD HP/XP text now shows real character values (`currentLife/maxLife`, `xp/xpToNextLevel`).
  - `index.html`: removed Bonus HUD block from top bar.
  - `pvp.js`: reward application now uses canonical hooks when available (`addGold`, `grantXP`).
- 2026-02-17: Combat Minimum for zone view (Kuestenpfad):
  - `script.js`: added zone combat runtime state (`zoneCombatState`) and `Start Combat` / `Stop Combat` toggle control in zone panel.
  - `script.js`: combat ticks only while active via `_tickZoneCombat(now)` inside `updateLogic()`.
  - `script.js`: per-hit damage uses canonical derived stats from `pveGrid` (`attackSpeed` schedules hit interval, `damageAverage`/`calculateCharacterDamageValue` for hit damage).
  - `script.js`: each hit updates zone monster HP text + bar immediately.
  - `script.js`: on kill increments `monsterDefeats`, rewards via `addGold(..., 'combat_kill')` and `grantXP(..., 'combat_kill', 'pveGrid')`, applies existing dropTable roll to bank (`addItemToBank`), then respawns via `spawnMonster(...)`.
  - `script.js`: zone combat is force-stopped when leaving zone/grind tab to prevent passive progression.
- 2026-02-17: Zone combat HUD/pacing/UI pass:
  - `script.js`: moved Start/Stop control below combat log text (same log panel, centered), outside scrollable log body.
  - `script.js`: restored sprite-first monster rendering with template fallback lookup by monster id.
  - `script.js`: added compact zone-only combat HUD (bottom-right) with Player/Monster HP + cooldown bars and placeholder Stamina/Mana rows.
  - `script.js`: attack interval interpretation made explicit and clamped for sane pacing; cooldown bars now visualize the exact timers used by combat loop.
  - `script.js`: monster cooldown timer is visualized without adding extra player-damage logic in this UI pass.
  - `style.css`: added minimal zone HUD/control styling (`.zone-combat-hud*`, `.zone-log-controls`, `.zone-combat-toggle-btn`) with responsive adjustments.
- 2026-02-18: Zone combat UI/loop fixes (minimal):
  - Moved Start/Stop combat control out of log panel to combat HUD area, centered directly above player HUD block.
  - Shifted base attack intervals by -3000ms for both player/monster before existing clamps (no new formulas).
  - Re-enabled monster hit application to canonical player HP source (`character.base.currentLife` fallback `gameData.hp`) and synced HUD-visible HP reduction.
  - Upgraded combat log to append-line mode (no full rerenders), added concise per-hit lines (`Player dealt X dmg`, `Monster dealt X dmg`), and increased log height for readability.
- 2026-02-18: Verification limits: `node` is not available in PATH (`NODE_NOT_FOUND`), so no local syntax/browser run was possible in this environment.
- 2026-02-19: Added Optionen tab/nav in `index.html` with two sections:
  - Keybind list UI (`#options-keybind-list`) with per-action rebind and reset-to-default button.
  - Audio sliders for menu/music/ambient volumes (0..100) wired to runtime settings.
- 2026-02-19: Added settings + keybind runtime manager in `script.js`:
  - Default keybinds with fallback behavior when unset (`rotateItem`, `toggleTooltips`, `cancelAction`).
  - Global resolver API (`window.matchesActionKeybinding`) + rebind capture flow + options rendering helpers.
- 2026-02-19: Added audio mixer/scheduler in `script.js`:
  - UI SFX paths migrated to `./Sounds/Menu/...` and menu SFX volume applied per playback.
  - Music channel plays shuffled tracks from `./Sounds/Music/`, with 5s fade in/out and 60s post-track gap.
  - Ambient channel plays shuffled coast clips from `./Sounds/Ambient/Coast/`, with 5s fade in/out and 40s post-clip gap.
  - Ambient is tied to active Küstenpfad zone view state and runs independently from music.
- 2026-02-19: Wired existing hardcoded key handlers to keybind manager:
  - `customDrag.js` rotation key
  - `storageEngine.js` cancel/escape handling
  - `itemTooltip.js` tooltip toggle key
- 2026-02-19: Save migration/settings update in `saveengine.js`:
  - bumped `SAVE_VERSION` to `6`
  - added v5->v6 migration to normalize `settings.audio` + `settings.keybinds`
  - save/load/new-game normalization now ensures option settings exist.
- 2026-02-19: Validation limits: `node` is not available in PATH in this environment, so `node --check` and Playwright client execution could not be run.
- 2026-02-19: UX hardening: leaving Optionen tab now clears pending key-rebind capture to avoid accidental global key capture outside options view.
- 2026-02-19: PRIO combat foundation fix in `script.js` (minimal, no new balance systems):
  - Added active combat grid resolver `getActiveCombatGridKey()`:
    - Uses `pveGrid` in Küstenpfad/zone combat context.
    - Otherwise resolves to current active setup (workshop type when relevant, else character-hub setup).
  - Added fresh derived stat read path `_getFreshDerivedCharacterStats(gridKey)` using the character.js compute pipeline (`computeCharacterStats` + `collectEquippedItemEntries`) so combat is not stuck on cached/legacy farm stats.
  - Zone combat tick now resolves fresh stats each tick from active combat grid key, so swapping PvE gear updates real combat immediately.
  - Player hit damage now uses derived stats first:
    - Rolls per-hit damage from derived `finalDamage` total min/max range when present.
    - Falls back to derived `damageAverage` when range is unavailable.
    - Uses legacy fallback only if derived damage fields are invalid/missing.
  - Player attack cadence now uses derived `attackSpeed` APS consistently for interval calculation; legacy speed fallback only if derived APS is missing/invalid.
  - Added explicit fallback logging with required tag and reason:
    - `LEGACY_FALLBACK_USED: <reason>` in combat log.
    - Structured `console.warn` payload includes context + active grid key.
  - Added combat-start verification hook log with required fields:
    - `activeGridKey`, `derived.attackSpeed`, `derived.damageAverage`, derived min/max range, computed interval, computed per-hit damage.
  - Combat log keeps per-hit line format: `Player dealt X dmg`.
  - Kill XP grant now uses resolved active combat grid key (instead of hardcoded PvE constant path).

- 2026-02-19: Verification attempt after combat fix:
  - `node --check script.js` failed because `node` is not available in PATH.
  - Skill-required Playwright client run failed for same reason (`node` not found).
  - `npx` is also unavailable in PATH (`NPX_NOT_FOUND`).
- 2026-02-19: Follow-up hardening for the same combat fix:
  - `updateLogic()` now reads fresh active combat-grid derived stats while zone combat/coast context is active to keep life/max-life sync aligned with PvE setup during combat ticks.
- 2026-02-19: Added minimal data-driven loot pool extension (no zone/world refactor):
  - New `lootPools.js` with named weighted pools (`coast_common`, `coast_uncommon`) supporting `rollsMin/rollsMax/perRollChance` and entry selectors (`itemId`, optional `baseType`/`tag`).
  - `index.html` now loads `lootPools.js` before monster/runtime scripts.
  - `monsters.js` coast monsters now optionally declare `lootPools` while keeping `dropTable` for backward compatibility.
  - `script.js` zone kill flow now uses pooled drops via `rollLootForMonster(monster, { itemLevel })` and routes resulting drops into Schlachtfeld insertion logic.
  - Legacy compatibility kept: if no `lootPools` are present, `dropTable` is internally treated as temporary one-item pools with default 15% per-roll chance.
  - Combat log now writes per-drop lines with item name + ilvl (and bank-full failure lines).

- 2026-02-19: Implemented data-driven loot pools v1 in lootPools.js with weighted entries, rollsMin/rollsMax, perRollChance, and legacy dropTable mapping via rollLootForMonster(...).
- 2026-02-19: Added optional lootPools to Kuestenpfad monsters in monsters.js while preserving dropTable fallback compatibility.
- 2026-02-19: Combat drop destination changed in script.js: zone kill drops now route to Schlachtfeld (addItemToBattlefield) instead of direct bank insertion.
- 2026-02-19: Added Schlachtfeld v1 data model in gameData plus save defaults/migration (saveengine.js v7, ensureBattlefieldDefaultsInData) and save sanitization/tracking support in itemDefs.js for battlefield.pages.
- 2026-02-19: Added Kuestenpfad Schlachtfeld UI in script.js + style.css: toggle button with item count, page tabs 1..9, static 15x6 slot grid, Store action, Sell mode selection, and Sell action using floor(baseValue * ilvl * 0.3) plus combat log feedback.
- 2026-02-19: Combat derived-stat wiring finalized in script.js: zone combat uses active combat grid key (pveGrid in Kuestenpfad context), recalculates derived stats per tick, uses derived APS and derived damage (range roll or average), logs LEGACY_FALLBACK_USED reasons, and logs combat-start stat snapshot plus per-hit damage lines.
- 2026-02-19: Integration fix in saveengine.js: renamed saveengine battlefield constants to avoid cross-script global const redeclaration with script.js.
- 2026-02-19: Schlachtfeld UI/layout fix pass: converted Schlachtfeld to single-slot stash model (8x3 per page, one item instance per slot), made actions visible (removed panel clipping/height cap), enlarged slot/icon visuals, added tooltip binding on battlefield item hover, and kept bank/workshop matrix behavior by restoring normal placement when storing to bank.
- 2026-02-19: Schlachtfeld top-bar UX tweak: moved Store/Sell/Sell mode into a top-right action group beside Schlachtfeld title, reduced action button size significantly, and made Schlachtfeld panel slightly less transparent (more opaque).
